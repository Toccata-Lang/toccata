
(deftype nougie [nougie-fn]
  (assert (instance? Fn nougie-fn))

  Stringable
  (string-list [x]
    (comp (list "<nougie ")
          (string-list nougie-fn)
          (list ">")))

  Function
  (invoke [ev s]
    (nougie-fn s)))

(main [_]
  (let [a 'boogity
        wrapper (nougie (fn [s]
                          (maybe [a s])))]
    (nougie (fn [s]
              (map (wrapper s)
                   (fn [[v ss]]
                     ;; TODO: even though this 'inc' blows up,
                     ;; the requirement on 'd' can't flow back up
                     (maybe [(inc v) ss])))))))
